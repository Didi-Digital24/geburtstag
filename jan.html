<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ‰ Digitale Geburtstagskarte</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Lucide Icons als SVG
        const Send = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        // Simple localStorage fallback for development/local testing
        const storage = {
            async get(key) {
                try {
                    const value = localStorage.getItem(key);
                    return value ? { key, value } : null;
                } catch (e) {
                    return null;
                }
            },
            async set(key, value) {
                try {
                    localStorage.setItem(key, value);
                    return { key, value };
                } catch (e) {
                    console.error('Storage error:', e);
                    return null;
                }
            }
        };

        // Use Claude's storage if available, otherwise fallback to localStorage
        const storageAPI = typeof window.storage !== 'undefined' ? window.storage : storage;

        function BirthdayCard() {
            const [signatures, setSignatures] = useState([]);
            const [name, setName] = useState('');
            const [message, setMessage] = useState('');
            const [isDrawing, setIsDrawing] = useState(false);
            const [hasDrawn, setHasDrawn] = useState(false);
            const canvasRef = useRef(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadSignatures();
            }, []);

            const loadSignatures = async () => {
                try {
                    const result = await storageAPI.get('birthday-signatures');
                    if (result && result.value) {
                        setSignatures(JSON.parse(result.value));
                    }
                } catch (error) {
                    console.log('No signatures yet');
                }
                setLoading(false);
            };

            const saveSignatures = async (newSignatures) => {
                try {
                    await storageAPI.set('birthday-signatures', JSON.stringify(newSignatures), true);
                } catch (error) {
                    console.error('Error saving:', error);
                }
            };

            const startDrawing = (e) => {
                setIsDrawing(true);
                setHasDrawn(true);
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                ctx.beginPath();
                ctx.moveTo(x, y);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                ctx.lineTo(x, y);
                ctx.strokeStyle = '#2563eb';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.stroke();
            };

            const stopDrawing = () => {
                setIsDrawing(false);
            };

            const clearCanvas = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                setHasDrawn(false);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!name.trim() || !message.trim()) {
                    alert('Bitte Name und Nachricht eingeben! ðŸŽˆ');
                    return;
                }

                const canvas = canvasRef.current;
                const signatureData = hasDrawn ? canvas.toDataURL() : null;

                const newSignature = {
                    id: Date.now(),
                    name: name.trim(),
                    message: message.trim(),
                    signature: signatureData,
                    timestamp: new Date().toISOString()
                };

                const updatedSignatures = [...signatures, newSignature];
                setSignatures(updatedSignatures);
                await saveSignatures(updatedSignatures);

                setName('');
                setMessage('');
                clearCanvas();
                
                alert('Deine Unterschrift wurde hinzugefÃ¼gt! ðŸŽ‰');
            };

            const downloadCard = () => {
                const dataStr = JSON.stringify(signatures, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'geburtstagskarte-unterschriften.json';
                link.click();
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-300 via-purple-300 to-indigo-400 flex items-center justify-center">
                        <div className="text-white text-2xl">LÃ¤dt... ðŸŽ‚</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-pink-300 via-purple-300 to-indigo-400 p-4 md:p-8">
                    <div className="max-w-4xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-3xl shadow-2xl p-8 mb-8 text-center relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-500 via-yellow-500 via-green-500 via-blue-500 to-purple-500"></div>
                            <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                ðŸŽ‰ Digitale Geburtstagskarte ðŸŽ‚
                            </h1>
                            <p className="text-gray-600 text-lg">
                                Hinterlasse deine GlÃ¼ckwÃ¼nsche und Unterschrift!
                            </p>
                            <div className="mt-4 text-sm text-gray-500">
                                {signatures.length} {signatures.length === 1 ? 'Unterschrift' : 'Unterschriften'} bisher âœ¨
                            </div>
                        </div>

                        {/* Sign Form */}
                        <div className="bg-white rounded-3xl shadow-2xl p-8 mb-8">
                            <h2 className="text-2xl font-bold mb-6 text-gray-800">Deine Unterschrift hinzufÃ¼gen</h2>
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Dein Name
                                    </label>
                                    <input
                                        type="text"
                                        value={name}
                                        onChange={(e) => setName(e.target.value)}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Max Mustermann"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Deine GlÃ¼ckwÃ¼nsche
                                    </label>
                                    <textarea
                                        value={message}
                                        onChange={(e) => setMessage(e.target.value)}
                                        rows={4}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Alles Gute zum Geburtstag! ðŸŽˆ"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Unterschrift malen (optional)
                                    </label>
                                    <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-50">
                                        <canvas
                                            ref={canvasRef}
                                            width={600}
                                            height={200}
                                            onMouseDown={startDrawing}
                                            onMouseMove={draw}
                                            onMouseUp={stopDrawing}
                                            onMouseLeave={stopDrawing}
                                            className="w-full bg-white rounded cursor-crosshair"
                                            style={{ touchAction: 'none' }}
                                        />
                                        <button
                                            type="button"
                                            onClick={clearCanvas}
                                            className="mt-3 flex items-center gap-2 text-sm text-gray-600 hover:text-red-600"
                                        >
                                            <Trash2 size={16} />
                                            Unterschrift lÃ¶schen
                                        </button>
                                    </div>
                                </div>

                                <button
                                    type="submit"
                                    className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 rounded-lg font-semibold text-lg hover:from-purple-600 hover:to-pink-600 transition-all flex items-center justify-center gap-2 shadow-lg"
                                >
                                    <Send size={20} />
                                    Unterschrift hinzufÃ¼gen
                                </button>
                            </form>
                        </div>

                        {/* Signatures Display */}
                        {signatures.length > 0 && (
                            <div className="bg-white rounded-3xl shadow-2xl p-8">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">
                                        Alle GlÃ¼ckwÃ¼nsche ðŸ’Œ
                                    </h2>
                                    <button
                                        onClick={downloadCard}
                                        className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm"
                                    >
                                        <Download size={16} />
                                        Exportieren
                                    </button>
                                </div>
                                
                                <div className="space-y-6">
                                    {signatures.map((sig) => (
                                        <div
                                            key={sig.id}
                                            className="border-2 border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow bg-gradient-to-r from-purple-50 to-pink-50"
                                        >
                                            <div className="flex items-start justify-between mb-3">
                                                <h3 className="text-xl font-bold text-purple-600">{sig.name}</h3>
                                                <span className="text-xs text-gray-500">
                                                    {new Date(sig.timestamp).toLocaleDateString('de-DE')}
                                                </span>
                                            </div>
                                            <p className="text-gray-700 mb-4 whitespace-pre-wrap">{sig.message}</p>
                                            {sig.signature && (
                                                <div className="border-t-2 border-gray-200 pt-4">
                                                    <img
                                                        src={sig.signature}
                                                        alt="Unterschrift"
                                                        className="max-w-full h-auto bg-white rounded p-2"
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {signatures.length === 0 && (
                            <div className="bg-white rounded-3xl shadow-2xl p-12 text-center">
                                <div className="text-6xl mb-4">ðŸŽˆ</div>
                                <p className="text-gray-500 text-lg">
                                    Noch keine Unterschriften. Sei der/die Erste!
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BirthdayCard />);
    </script>
</body>
</html>
